# 리플렉션
- Go의 고급 기능인 리플렉션을 먼저 다루는 이유는 쉬운 주제이기 때문이 아니라 Go에서 다른 여러 데이터 타입, 인터페이스가 어떻게 작동하는지 이해를 돕기 때문이다.어떤 경우에는 실행 시점에 구조체 필드의 이름을 알아야 할 때가 있다. 이때 리플렉션을 사용해야 한다. 리플렉션은 구조체의 필드와 값을 출력할 수 있게 할 뿐만 아니라 JSON 데이터를 디코딩해 만들어지는 구조체처럼 실제 구조를 알지 못하는 구조체를 다룰 수 있게 만들어준다.

### Go에 리플렉션이 왜 있을까?
- 리플렉션을 통해 동적으로 임의의 오브젝트 구조에 대한 정보를 알아낼 수 있기 때문이다. Go에서는 reflect 패키지로 이 기능을 제공한다. 3장에서 fmt.Println() 함수는 매개변수의 데이터 타입을 이해하고 타입에 따라 다르게 행동한다고 했다. 이 fmt 패키지에서도 내부에서 리플렉션을 사용한다.

### 리플렉션을 언제 사용할까?
- 리플렉션을 이용하면 프로그램을 작성할 때는 존재하지 않지만 실행 시점에 존재하는 데이터 타입을 처리할 수 있게 해준다.
- 또한 데이터 타입에 공통 인터페이스를 구현하지 않아 일반적이지 않거나 알 수 없는 행위를 할 때 리플렉션을 유용하게 활용할 수 있다. 일반적이지 않다는 것은 부정적인 의미가 아닌 사용자가 정의한 구조체에서 하는 행위를 말한다.
- Go에 제네릭이 도입됨에 따라 리플렉션을 덜 빈번하게 사용하게 될 수도 있다. 제네릭을 사용하면 다른 데이터 타입들도 쉽게 다룰 수 있고 더 나아가서는 정확한 데이터 타입을 몰라도 되기 때문이다. 자세한 내용은 chapter13에서 다룬다.

#### 사용방법
- reflect 패키지에서 주로 사용하는 타입은 reflect.Value와 reflect.Type이다. reflect.Value는 특정 타입의 값을 저장하는 데 사용하고 reflect.Type은 Go에서 지원하는 타입을 표현하는 데 사용한다. reflect.TypeOf()와 reflect.ValueOf()는 각각 reflect.Type과 reflect.Value 값을 반환한다. reflect.TypeOf()는 변수의 실제 타입을 반환한다는 점을 주의해야한다. 구조체를 매개변수로 넘기면 구조체의 이름을 반환한다.
- Go의 구조체는 매우 중요하므로 reflect 패키지는 구조체의 필드 개수를 알 수 있는 reflect.NumField() 메서드를 제공하고 Field() 메서드로 구조체 특정 필드의 reflect.Value 값을 얻을 수 있다.
- reflect.Kind 데이터 타입이 있는데, 이는 int, struct와 같이 변수의 데이터 타입 종류를 나타낸다. Kind() 함수는 변수의 종류가 무엇인지 반환한다.
- Int()와 String() 메서드는 reflect.Value 값에 대응하는 정수와 문자열 값을 반환한다.

### 정리
- 리플렉션 코드는 읽기 어려워 보일 수도 있다. 따라서 Go 철학에 따라 리플렉션이 정말 필요한 곳이 아니라면 리플렉션을 사용하지 말아야 한다. 리플렉션은 좋은 기능을 갖고 있는 것은 맞지만 깔끔한 코드를 만들어주지는 않는다. 

## 리플렉션의 세 가지 단점
1. 코드를 이해하기 어렵고 관리하기 힘들어진다.
2. 실행 속도가 느려진다. 또한 타입을 동적으로 다루는 코드는 리팩토링이나 분석을 수행하는 도구를 적용하기 힘들다.
3. 리플렉션에 관련된 에러는 빌드 시간에 잡을 수 ㅇ벗고 프로그램을 실행하다가 패닉이 발생해서야 발견하게 된다. 이를 막기 위해서 문제가 발생할 수 있는 함수를 충분히 테스트하는 코드를 추가하는 것이다. 하지만 이로 인해 코드가 늘어나서 속도는 더욱 느려진다.